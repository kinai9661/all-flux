<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flux AI Pro - AI åœ–åƒç”Ÿæˆå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .style-card { transition: all 0.3s; cursor: pointer; }
        .style-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3); }
        .style-card.active { border: 2px solid #8b5cf6; background: rgba(139, 92, 246, 0.2); }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 min-h-screen text-white">
    <div class="container mx-auto px-4 py-8">
        <!-- é ‚éƒ¨æ¨™é¡Œ -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-bold mb-2">
                <span class="bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                    ğŸ¨ Flux AI Pro
                </span>
            </h1>
            <p class="text-gray-400">AI åœ–åƒç”Ÿæˆå™¨ | 45+ è—è¡“é¢¨æ ¼</p>
            <div id="apiStatus" class="mt-2 text-sm"></div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- å·¦å´ï¼šåƒæ•¸é¢æ¿ -->
            <div class="lg:col-span-1 space-y-4">
                <!-- æç¤ºè© -->
                <div class="glass rounded-xl p-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ’¬ æç¤ºè©
                    </h2>
                    <textarea 
                        id="prompt" 
                        rows="5" 
                        placeholder="æè¿°ä½ æƒ³ç”Ÿæˆçš„åœ–åƒ...

ä¾‹å¦‚ï¼š
â€¢ A beautiful sunset over mountains
â€¢ ä¸€éš»å¯æ„›çš„è²“å’ªåœ¨èŠ±åœ’è£¡ç©è€
â€¢ Cyberpunk city at night, neon lights"
                        class="w-full bg-gray-800/50 border border-gray-700 rounded-lg p-3 text-white placeholder-gray-500 focus:ring-2 focus:ring-purple-500 focus:outline-none"
                    ></textarea>
                    
                    <div class="mt-4">
                        <label class="text-sm text-gray-400 mb-2 block">è² é¢æç¤ºè©ï¼ˆå¯é¸ï¼‰</label>
                        <textarea 
                            id="negativePrompt" 
                            rows="2" 
                            placeholder="ä¸æƒ³è¦çš„å…§å®¹... ä¾‹å¦‚ï¼šblurry, low quality"
                            class="w-full bg-gray-800/50 border border-gray-700 rounded-lg p-3 text-white placeholder-gray-500 focus:ring-2 focus:ring-purple-500 focus:outline-none"
                        ></textarea>
                    </div>
                </div>

                <!-- åŸºæœ¬åƒæ•¸ -->
                <div class="glass rounded-xl p-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        âš™ï¸ ç”Ÿæˆåƒæ•¸
                    </h2>
                    
                    <div class="space-y-4">
                        <!-- æ¨¡å‹ -->
                        <div>
                            <label class="text-sm text-gray-400 mb-2 block">æ¨¡å‹</label>
                            <select id="model" class="w-full bg-gray-800/50 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-purple-500 focus:outline-none">
                                <option value="zimage">âš¡ Z-Image Turbo</option>
                                <option value="flux">ğŸ¨ Flux æ¨™æº–ç‰ˆ</option>
                                <option value="turbo">âš¡ Flux Turbo</option>
                                <option value="kontext">ğŸ–¼ï¸ Kontext</option>
                            </select>
                        </div>

                        <!-- å°ºå¯¸ -->
                        <div>
                            <label class="text-sm text-gray-400 mb-2 block">å°ºå¯¸</label>
                            <select id="size" class="w-full bg-gray-800/50 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-purple-500 focus:outline-none">
                                <option value="1024,1024">â¬œ æ–¹å½¢ 1024x1024</option>
                                <option value="1536,1536">â¬œ æ–¹å½¢ 1536x1536</option>
                                <option value="1080,1920">ğŸ“± è±å± 1080x1920</option>
                                <option value="1920,1080">ğŸ–¥ï¸ æ©«å± 1920x1080</option>
                            </select>
                        </div>

                        <!-- è³ªé‡æ¨¡å¼ -->
                        <div>
                            <label class="text-sm text-gray-400 mb-2 block">è³ªé‡æ¨¡å¼</label>
                            <select id="qualityMode" class="w-full bg-gray-800/50 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-purple-500 focus:outline-none">
                                <option value="economy">âš¡ ç¶“æ¿Ÿæ¨¡å¼</option>
                                <option value="standard" selected>âš–ï¸ æ¨™æº–æ¨¡å¼</option>
                                <option value="ultra">ğŸ’ è¶…é«˜æ¸…æ¨¡å¼</option>
                            </select>
                        </div>

                        <!-- Seed -->
                        <div>
                            <label class="text-sm text-gray-400 mb-2 block">Seed (-1 = éš¨æ©Ÿ)</label>
                            <input 
                                type="number" 
                                id="seed" 
                                value="-1" 
                                min="-1" 
                                max="999999"
                                class="w-full bg-gray-800/50 border border-gray-700 rounded-lg p-3 text-white focus:ring-2 focus:ring-purple-500 focus:outline-none"
                            >
                        </div>
                    </div>

                    <!-- ç”ŸæˆæŒ‰éˆ• -->
                    <button 
                        id="generateBtn" 
                        onclick="generateImage()" 
                        class="w-full mt-6 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-4 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        <span id="btnText">âœ¨ é–‹å§‹ç”Ÿæˆ</span>
                    </button>
                </div>
            </div>

            <!-- ä¸­é–“ï¼šé¢¨æ ¼é¸æ“‡ -->
            <div class="lg:col-span-1">
                <div class="glass rounded-xl p-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ¨ è—è¡“é¢¨æ ¼
                    </h2>
                    <div id="styleSelector" class="space-y-2 max-h-[600px] overflow-y-auto">
                        <!-- å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- å³å´ï¼šçµæœå±•ç¤º -->
            <div class="lg:col-span-1">
                <div class="glass rounded-xl p-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ–¼ï¸ ç”Ÿæˆçµæœ
                    </h2>
                    <div id="resultContainer">
                        <div class="text-center text-gray-400 py-20">
                            <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <p>å°šæœªç”Ÿæˆåœ–åƒ</p>
                            <p class="text-sm mt-2">å¡«å¯«åƒæ•¸å¾Œé»æ“Šç”Ÿæˆ</p>
                        </div>
                    </div>
                </div>

                <!-- æ­·å²è¨˜éŒ„ -->
                <div class="glass rounded-xl p-6 mt-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ“š æ­·å²è¨˜éŒ„
                        <button onclick="clearHistory()" class="ml-auto text-sm text-red-400 hover:text-red-300">ğŸ—‘ï¸ æ¸…ç©º</button>
                    </h2>
                    <div id="historyContainer" class="grid grid-cols-2 gap-2 max-h-[400px] overflow-y-auto">
                        <p class="col-span-2 text-center text-gray-400 py-8">æš«ç„¡æ­·å²</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const STYLES = {
            none: { name: 'ç„¡é¢¨æ ¼', icon: 'âš¡', category: 'åŸºç¤' },
            anime: { name: 'å‹•æ¼«', icon: 'ğŸ­', category: 'æ’ç•«' },
            ghibli: { name: 'å‰åœåŠ›', icon: 'ğŸƒ', category: 'æ’ç•«' },
            manga: { name: 'æ—¥æœ¬æ¼«ç•«', icon: 'ğŸ“–', category: 'æ¼«ç•«' },
            'manga-color': { name: 'å½©è‰²æ¼«ç•«', icon: 'ğŸ¨', category: 'æ¼«ç•«' },
            chibi: { name: 'Qç‰ˆ', icon: 'ğŸ¥°', category: 'æ¼«ç•«' },
            photorealistic: { name: 'å¯«å¯¦', icon: 'ğŸ“·', category: 'å¯«å¯¦' },
            'oil-painting': { name: 'æ²¹ç•«', icon: 'ğŸ–¼ï¸', category: 'ç¹ªç•«' },
            watercolor: { name: 'æ°´å½©', icon: 'ğŸ’§', category: 'ç¹ªç•«' },
            cyberpunk: { name: 'è³½åšæœ‹å…‹', icon: 'ğŸŒƒ', category: 'è¦–è¦º' },
            neon: { name: 'éœ“è™¹', icon: 'ğŸ’¡', category: 'è¦–è¦º' },
            vintage: { name: 'å¾©å¤', icon: 'ğŸ“»', category: 'è¦–è¦º' },
            'pixel-art': { name: 'åƒç´ ', icon: 'ğŸ®', category: 'æ•¸ä½' },
            '3d-render': { name: '3Dæ¸²æŸ“', icon: 'ğŸ¬', category: 'æ•¸ä½' },
            fantasy: { name: 'å¥‡å¹»', icon: 'ğŸ‰', category: 'å¥‡å¹»' }
        };

        let selectedStyle = 'none';
        let history = JSON.parse(localStorage.getItem('aiImageHistory') || '[]');

        // åˆå§‹åŒ–
        async function init() {
            renderStyleSelector();
            renderHistory();
            await checkAPIStatus();
        }

        // æ¸²æŸ“é¢¨æ ¼é¸æ“‡å™¨
        function renderStyleSelector() {
            const container = document.getElementById('styleSelector');
            let html = '';
            
            Object.entries(STYLES).forEach(([id, style]) => {
                const isActive = id === selectedStyle ? 'active' : '';
                html += `
                    <div class="style-card ${isActive} bg-gray-800/50 border border-gray-700 rounded-lg p-3" onclick="selectStyle('${id}')">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">${style.icon}</span>
                            <div>
                                <p class="font-semibold">${style.name}</p>
                                <p class="text-xs text-gray-400">${style.category}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // é¸æ“‡é¢¨æ ¼
        function selectStyle(styleId) {
            selectedStyle = styleId;
            renderStyleSelector();
        }

        // æª¢æŸ¥ API ç‹€æ…‹
        async function checkAPIStatus() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                document.getElementById('apiStatus').innerHTML = `
                    <span class="text-green-400">âœ… API æ­£å¸¸</span>
                    <span class="text-gray-500 mx-2">|</span>
                    <span class="text-gray-400">v${data.data.version}</span>
                `;
            } catch (e) {
                document.getElementById('apiStatus').innerHTML = '<span class="text-red-400">âŒ API é€£æ¥å¤±æ•—</span>';
            }
        }

        // ç”Ÿæˆåœ–åƒ
        async function generateImage() {
            const prompt = document.getElementById('prompt').value.trim();
            if (!prompt) {
                alert('è«‹è¼¸å…¥æç¤ºè©ï¼');
                return;
            }

            const btn = document.getElementById('generateBtn');
            const btnText = document.getElementById('btnText');
            const resultContainer = document.getElementById('resultContainer');
            
            // ç¦ç”¨æŒ‰éˆ•
            btn.disabled = true;
            btnText.innerHTML = '<span class="animate-spin inline-block">âš™ï¸</span> ç”Ÿæˆä¸­...';
            
            // é¡¯ç¤ºåŠ è¼‰
            resultContainer.innerHTML = `
                <div class="text-center py-20">
                    <div class="animate-spin text-6xl mb-4">âš™ï¸</div>
                    <p class="text-gray-400">AI æ­£åœ¨å‰µä½œä¸­...</p>
                    <p class="text-sm text-gray-500 mt-2">é€™å¯èƒ½éœ€è¦ 30-60 ç§’</p>
                </div>
            `;

            try {
                const [width, height] = document.getElementById('size').value.split(',').map(Number);
                
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt,
                        model: document.getElementById('model').value,
                        width,
                        height,
                        negative_prompt: document.getElementById('negativePrompt').value,
                        style: selectedStyle,
                        quality_mode: document.getElementById('qualityMode').value,
                        seed: parseInt(document.getElementById('seed').value)
                    })
                });

                if (response.ok) {
                    const contentType = response.headers.get('content-type');
                    
                    if (contentType?.startsWith('image/')) {
                        const blob = await response.blob();
                        const imageUrl = URL.createObjectURL(blob);
                        displayImage(imageUrl, {
                            model: response.headers.get('x-model'),
                            seed: response.headers.get('x-seed'),
                            width: response.headers.get('x-width'),
                            height: response.headers.get('x-height')
                        });
                        addToHistory({ imageUrl, prompt, metadata: {} });
                    } else {
                        const data = await response.json();
                        if (data.success && data.data[0]) {
                            displayImage(data.data[0].image, data.data[0].metadata);
                            addToHistory({ imageUrl: data.data[0].image, prompt, metadata: data.data[0].metadata });
                        }
                    }
                } else {
                    throw new Error('ç”Ÿæˆå¤±æ•—');
                }
            } catch (error) {
                resultContainer.innerHTML = `
                    <div class="text-center py-20 text-red-400">
                        <p class="text-4xl mb-4">âŒ</p>
                        <p>ç”Ÿæˆå¤±æ•—</p>
                        <p class="text-sm text-gray-400 mt-2">${error.message}</p>
                    </div>
                `;
            } finally {
                btn.disabled = false;
                btnText.innerHTML = 'âœ¨ é–‹å§‹ç”Ÿæˆ';
            }
        }

        // é¡¯ç¤ºåœ–åƒ
        function displayImage(imageUrl, metadata) {
            const container = document.getElementById('resultContainer');
            container.innerHTML = `
                <div class="fade-in">
                    <img src="${imageUrl}" class="w-full rounded-lg mb-4 border border-gray-700">
                    <div class="flex flex-wrap gap-2 mb-4">
                        <span class="px-3 py-1 bg-purple-500/20 text-purple-300 rounded-full text-xs">${metadata.model || 'unknown'}</span>
                        <span class="px-3 py-1 bg-green-500/20 text-green-300 rounded-full text-xs">Seed: ${metadata.seed || 'N/A'}</span>
                        <span class="px-3 py-1 bg-blue-500/20 text-blue-300 rounded-full text-xs">${metadata.width}x${metadata.height}</span>
                    </div>
                    <button onclick="downloadImage('${imageUrl}', ${metadata.seed})" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                        ğŸ’¾ ä¸‹è¼‰åœ–ç‰‡
                    </button>
                </div>
            `;
        }

        // ä¸‹è¼‰åœ–ç‰‡
        function downloadImage(url, seed) {
            const a = document.createElement('a');
            a.href = url;
            a.download = `flux-ai-${seed || Date.now()}.png`;
            a.click();
        }

        // æ·»åŠ åˆ°æ­·å²
        function addToHistory(item) {
            history.unshift({ ...item, timestamp: Date.now() });
            if (history.length > 20) history = history.slice(0, 20);
            localStorage.setItem('aiImageHistory', JSON.stringify(history));
            renderHistory();
        }

        // æ¸²æŸ“æ­·å²
        function renderHistory() {
            const container = document.getElementById('historyContainer');
            if (history.length === 0) {
                container.innerHTML = '<p class="col-span-2 text-center text-gray-400 py-8">æš«ç„¡æ­·å²</p>';
                return;
            }
            
            let html = '';
            history.forEach((item, idx) => {
                html += `
                    <div class="cursor-pointer hover:opacity-80 transition-opacity" onclick="displayImage('${item.imageUrl}', ${JSON.stringify(item.metadata).replace(/"/g, '&quot;')})">
                        <img src="${item.imageUrl}" class="w-full h-24 object-cover rounded-lg border border-gray-700">
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // æ¸…ç©ºæ­·å²
        function clearHistory() {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ­·å²è¨˜éŒ„å—ï¼Ÿ')) {
                history = [];
                localStorage.removeItem('aiImageHistory');
                renderHistory();
            }
        }

        // åˆå§‹åŒ–
        init();
    </script>
</body>
</html>